/**
*  Contemplate
*  Light-weight Template Engine for PHP, Python, Node and client-side JavaScript
*
*  @version: 0.6.5
*  https://github.com/foo123/Contemplate
*
*  @inspired by : Simple JavaScript Templating, John Resig - http://ejohn.org/ - MIT Licensed
*  http://ejohn.org/blog/javascript-micro-templating/
*
**/
!function(e,t,n){"object"==typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):e[t]=n()}(this,"Contemplate",function(e){"use strict";function t(e,t){var n,r={},u={},i={},o={},l={},a={};if(i[0]="HTML_SPECIALCHARS",i[1]="HTML_ENTITIES",o[0]="ENT_NOQUOTES",o[2]="ENT_COMPAT",o[3]="ENT_QUOTES",l=isNaN(e)?e?e.toUpperCase():"HTML_SPECIALCHARS":i[e],a=isNaN(t)?t?t.toUpperCase():"ENT_COMPAT":o[t],"HTML_SPECIALCHARS"!==l&&"HTML_ENTITIES"!==l)throw new Error("Table: "+l+" not supported");r["38"]="&amp;","HTML_ENTITIES"===l&&(r["160"]="&nbsp;",r["161"]="&iexcl;",r["162"]="&cent;",r["163"]="&pound;",r["164"]="&curren;",r["165"]="&yen;",r["166"]="&brvbar;",r["167"]="&sect;",r["168"]="&uml;",r["169"]="&copy;",r["170"]="&ordf;",r["171"]="&laquo;",r["172"]="&not;",r["173"]="&shy;",r["174"]="&reg;",r["175"]="&macr;",r["176"]="&deg;",r["177"]="&plusmn;",r["178"]="&sup2;",r["179"]="&sup3;",r["180"]="&acute;",r["181"]="&micro;",r["182"]="&para;",r["183"]="&middot;",r["184"]="&cedil;",r["185"]="&sup1;",r["186"]="&ordm;",r["187"]="&raquo;",r["188"]="&frac14;",r["189"]="&frac12;",r["190"]="&frac34;",r["191"]="&iquest;",r["192"]="&Agrave;",r["193"]="&Aacute;",r["194"]="&Acirc;",r["195"]="&Atilde;",r["196"]="&Auml;",r["197"]="&Aring;",r["198"]="&AElig;",r["199"]="&Ccedil;",r["200"]="&Egrave;",r["201"]="&Eacute;",r["202"]="&Ecirc;",r["203"]="&Euml;",r["204"]="&Igrave;",r["205"]="&Iacute;",r["206"]="&Icirc;",r["207"]="&Iuml;",r["208"]="&ETH;",r["209"]="&Ntilde;",r["210"]="&Ograve;",r["211"]="&Oacute;",r["212"]="&Ocirc;",r["213"]="&Otilde;",r["214"]="&Ouml;",r["215"]="&times;",r["216"]="&Oslash;",r["217"]="&Ugrave;",r["218"]="&Uacute;",r["219"]="&Ucirc;",r["220"]="&Uuml;",r["221"]="&Yacute;",r["222"]="&THORN;",r["223"]="&szlig;",r["224"]="&agrave;",r["225"]="&aacute;",r["226"]="&acirc;",r["227"]="&atilde;",r["228"]="&auml;",r["229"]="&aring;",r["230"]="&aelig;",r["231"]="&ccedil;",r["232"]="&egrave;",r["233"]="&eacute;",r["234"]="&ecirc;",r["235"]="&euml;",r["236"]="&igrave;",r["237"]="&iacute;",r["238"]="&icirc;",r["239"]="&iuml;",r["240"]="&eth;",r["241"]="&ntilde;",r["242"]="&ograve;",r["243"]="&oacute;",r["244"]="&ocirc;",r["245"]="&otilde;",r["246"]="&ouml;",r["247"]="&divide;",r["248"]="&oslash;",r["249"]="&ugrave;",r["250"]="&uacute;",r["251"]="&ucirc;",r["252"]="&uuml;",r["253"]="&yacute;",r["254"]="&thorn;",r["255"]="&yuml;"),"ENT_NOQUOTES"!==a&&(r["34"]="&quot;"),"ENT_QUOTES"===a&&(r["39"]="&#39;"),r["60"]="&lt;",r["62"]="&gt;";for(n in r)r.hasOwnProperty(n)&&(u[String.fromCharCode(n)]=r[n]);return u}function n(e,n,r,u){var i=t("HTML_ENTITIES",n),o="";if(e=null==e?"":e+"",!i)return!1;if(n&&"ENT_QUOTES"===n&&(i["'"]="&#039;"),u||null==u)for(o in i)i.hasOwnProperty(o)&&(e=e.split(o).join(i[o]));else e=e.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(e,t,n){for(o in i)i.hasOwnProperty(o)&&(t=t.split(o).join(i[o]));return t+n});return e}function r(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function u(e,t){var n,r=0;if(null===e||"undefined"==typeof e)return 0;if(e.constructor!==Array&&e.constructor!==Object)return 1;"COUNT_RECURSIVE"===t&&(t=1),1!=t&&(t=0);for(n in e)e.hasOwnProperty(n)&&(r++,1!=t||!e[n]||e[n].constructor!==Array&&e[n].constructor!==Object||(r+=u(e[n],1)));return r}function i(e){var t,n=function(e){var t=/\W*function\s+([\w\$]+)\s*\(/.exec(e);return t?t[1]:"(Anonymous)"},r=function(e){if(!e||"object"!=typeof e||"number"!=typeof e.length)return!1;var t=e.length;return e[e.length]="bogus",t!==e.length?(e.length-=1,!0):(delete e[e.length],!1)};return e&&"object"==typeof e?(t=null,r(e)||(!t||0!==parseInt(t.local_value,10)&&(!t.local_value.toLowerCase||"off"!==t.local_value.toLowerCase()))&&"[object Object]"===Object.prototype.toString.call(e)&&"Object"===n(e.constructor)):!1}function o(e){var t,n={};if(e&&"object"==typeof e&&e.change_key_case)return e.flip();for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n}function l(){var e=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,t=arguments,n=0,r=t[n++],u=function(e,t,n,r){n||(n=" ");var u=e.length>=t?"":Array(1+t-e.length>>>0).join(n);return r?e+u:u+e},i=function(e,t,n,r,i,o){var l=r-e.length;return l>0&&(e=n||!i?u(e,r,o,n):e.slice(0,t.length)+u("",l,"0",!0)+e.slice(t.length)),e},o=function(e,t,n,r,o,l,a){var s=e>>>0;return n=n&&s&&{2:"0b",8:"0",16:"0x"}[t]||"",e=n+u(s.toString(t),l||0,"0",!1),i(e,n,r,o,a)},l=function(e,t,n,r,u,o){return null!=r&&(e=e.slice(0,r)),i(e,"",t,n,u,o)},a=function(e,r,a,s,c,f,d){var p,_,g,h,m;if("%%"==e)return"%";for(var v=!1,O="",E=!1,C=!1,b=" ",T=a.length,A=0;a&&T>A;A++)switch(a.charAt(A)){case" ":O=" ";break;case"+":O="+";break;case"-":v=!0;break;case"'":b=a.charAt(A+1);break;case"0":E=!0;break;case"#":C=!0}if(s=s?"*"==s?+t[n++]:"*"==s.charAt(0)?+t[s.slice(1,-1)]:+s:0,0>s&&(s=-s,v=!0),!isFinite(s))throw new Error("sprintf: (minimum-)width must be finite");switch(f=f?"*"==f?+t[n++]:"*"==f.charAt(0)?+t[f.slice(1,-1)]:+f:"fFeE".indexOf(d)>-1?6:"d"==d?0:void 0,m=r?t[r.slice(0,-1)]:t[n++],d){case"s":return l(String(m),v,s,f,E,b);case"c":return l(String.fromCharCode(+m),v,s,f,E);case"b":return o(m,2,C,v,s,f,E);case"o":return o(m,8,C,v,s,f,E);case"x":return o(m,16,C,v,s,f,E);case"X":return o(m,16,C,v,s,f,E).toUpperCase();case"u":return o(m,10,C,v,s,f,E);case"i":case"d":return p=+m||0,p=Math.round(p-p%1),_=0>p?"-":O,m=_+u(String(Math.abs(p)),f,"0",!1),i(m,_,v,s,E);case"e":case"E":case"f":case"F":case"g":case"G":return p=+m,_=0>p?"-":O,g=["toExponential","toFixed","toPrecision"]["efg".indexOf(d.toLowerCase())],h=["toString","toUpperCase"]["eEfFgG".indexOf(d)%2],m=_+Math.abs(p)[g](f),i(m,_,v,s,E)[h]();default:return e}};return r.replace(e,a)}function a(e,t){t=t?(t+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1"):" \\s ";var n=new RegExp("^["+t+"]+","g");return(e+"").replace(n,"")}function s(e,t){t=t?(t+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"\\$1"):" \\s ";var n=new RegExp("["+t+"]+$","g");return(e+"").replace(n,"")}function c(e,t){var n,r=0,u=0;for(e+="",t?(t+="",n=t.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1")):n=" \n\r	\f            ​\u2028\u2029　",r=e.length,u=0;r>u;u++)if(-1===n.indexOf(e.charAt(u))){e=e.substring(u);break}for(r=e.length,u=r-1;u>=0;u--)if(-1===n.indexOf(e.charAt(u))){e=e.substring(0,u+1);break}return-1===n.indexOf(e.charAt(0))?e:""}function f(){return Math.floor((new Date).getTime()/1e3)}function d(e,t){var n,r,u,i=/\\?([a-z])/gi,o=function(e,t){return e=e.toString(),e.length<t?o("0"+e,t,"0"):e},l=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"];u=function(e,t){return r[e]?r[e]():t},r={d:function(){return o(r.j(),2)},D:function(){return r.l().slice(0,3)},j:function(){return n.getDate()},l:function(){return l[r.w()]+"day"},N:function(){return r.w()||7},S:function(){var e=r.j();return 4>e|e>20&&(["st","nd","rd"][e%10-1]||"th")},w:function(){return n.getDay()},z:function(){var e=new Date(r.Y(),r.n()-1,r.j()),t=new Date(r.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){var e=new Date(r.Y(),r.n()-1,r.j()-r.N()+3),t=new Date(e.getFullYear(),0,4);return o(1+Math.round((e-t)/864e5/7),2)},F:function(){return l[6+r.n()]},m:function(){return o(r.n(),2)},M:function(){return r.F().slice(0,3)},n:function(){return n.getMonth()+1},t:function(){return new Date(r.Y(),r.n(),0).getDate()},L:function(){var e=r.Y();return 0===e%4&0!==e%100|0===e%400},o:function(){var e=r.n(),t=r.W(),n=r.Y();return n+(12===e&&9>t?1:1===e&&t>9?-1:0)},Y:function(){return n.getFullYear()},y:function(){return r.Y().toString().slice(-2)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return r.a().toUpperCase()},B:function(){var e=3600*n.getUTCHours(),t=60*n.getUTCMinutes(),r=n.getUTCSeconds();return o(Math.floor((e+t+r+3600)/86.4)%1e3,3)},g:function(){return r.G()%12||12},G:function(){return n.getHours()},h:function(){return o(r.g(),2)},H:function(){return o(r.G(),2)},i:function(){return o(n.getMinutes(),2)},s:function(){return o(n.getSeconds(),2)},u:function(){return o(1e3*n.getMilliseconds(),6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var e=new Date(r.Y(),0),t=Date.UTC(r.Y(),0),n=new Date(r.Y(),6),u=Date.UTC(r.Y(),6);return e-t!==n-u?1:0},O:function(){var e=n.getTimezoneOffset(),t=Math.abs(e);return(e>0?"-":"+")+o(100*Math.floor(t/60)+t%60,4)},P:function(){var e=r.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-n.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(i,u)},r:function(){return"D, d M Y H:i:s O".replace(i,u)},U:function(){return 0|n/1e3}};var a=function(e,t){return n=void 0===t?new Date:t instanceof Date?new Date(t):new Date(1e3*t),e.replace(i,u)};return a(e,t)}function p(e,t,n){for(var r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=d(t,n),i=0,o=r.length;o>i;i++)e[r[i]]&&(u=u.replace(r[i],e[r[i]]));return u}var _,g="0.6.5",h=Object.prototype,m=Array.prototype,v=Function.prototype,O=v.call.bind(h.toString),E=v.call.bind(h.hasOwnProperty),C=v.call.bind(m.slice),b="undefined"!=typeof global&&"[object global]"===O(global),T=function(e){return"[object Array]"===O(e)||e instanceof Array},A=b?require("fs"):null,y=A?A.writeFileSync:null,S=A?A.readFileSync:null,w=A?A.existsSync:null,D=A?A.statSync:null,N=(A?A.realpathSync:null,A?A.writeFile:null),j=A?A.readFile:null,M=(A?A.exists:null,A?A.stat:null,A?A.realpath:null,function(e,t,n,r){var u;return u=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r?(u.onload=function(){200===u.status?r(u.responseText):r("")},u.open(e,t,!0),u.send(n),""):(u.open(e,t,!1),u.send(n),200===u.status?u.responseText:"")}),I=!1,x={},k={},L=!1,U=0,F="./",H={},R={},K={},P={},B="<%",$="%>",G="",Y="",q="",z="' + \"\\n\" + '",V="",J=b?require("os").EOL:"\n",W=!0,X=null,Z=0,Q="    ",et=0,tt=0,nt=0,rt=0,ut=2,it=null,ot=null,lt=null,at=null,st=null,ct=-1,ft=null,dt=0,pt=/[ -]/g,_t=/\n\r|\r\n|\n|\r/g,gt=/^[a-zA-Z_]/,ht=/^[0-9]/,mt=/^[a-zA-Z0-9_]/i,vt=/^\s/,Ot={specials:null,replacements:null,functions:null,controls:null,controls2:null},Et=["include","template","extends","endblock","block","elsefor","endfor","for","set","unset","isset","elseif","else","endif","if"],Ct=["htmlselect","htmltable","plugin_([a-zA-Z0-9_]+)","haskey","lowercase","uppercase","camelcase","snakecase","pluralise","concat","ltrim","rtrim","trim","sprintf","addslashes","stripslashes","tpl","uuid","html","url","count","ldate","date","now","locale","dq","q","l","s","n","f"],bt={},Tt=function(){tt=0,nt=0,rt=0,ut=2,Z=0,it=[],ot={},lt=[[null,-1]],ft=null},At=function(){X.push([tt,nt,rt,ut,Z,it,ot,lt,ft])},yt=function(){var e=X.pop();tt=e[0],nt=e[1],rt=e[2],ut=e[3],Z=e[4],it=e[5],ot=e[6],lt=e[7],ft=e[8]},St=function(){return C(arguments).join(J)},wt=function(e,t){if(2>arguments.length&&(t=Z),t>=0){t=0===t?t:t+1;var n,r,u=new Array(t).join(Q);for(e=e.split(_t),r=e.length,n=0;r>n;n++)e[n]=u+e[n];return e.join(J)}return e},Dt=function(){var e=C(arguments);if(!(e.length<1)){var t,n,r,u=e.shift(),i=e.length;for(t=0;i>t;t++)if(r=e[t])for(n in r)E(r,n)&&(u[n]=r[n]);return u}},Nt=function(e,t){var n,r;if(t)r=c(t).split(" "),B=c(r[0]),$=c(r[1]);else{for(n=e.split("\n");n.length&&!c(n[0]).length;)n.shift();n.length&&(r=c(n.shift()).split(" "),B=c(r[0]),$=c(r[1])),e=n.join("\n")}return e},jt=function(e,t){return P[e]?L&&t?(t(P[e]),""):P[e]:R[e]?b&&A?L&&t?(j(R[e],{encoding:_.ENCODING},function(e,n){e?t(""):t(n)}),""):S(R[e],{encoding:_.ENCODING}):"#"===R[e].charAt(0)?L&&t?(t(window.document.getElementById(R[e].substring(1)).innerHTML||""),""):window.document.getElementById(R[e].substring(1)).innerHTML||"":L&&t?(M("GET",R[e],null,t),""):M("GET",R[e]):""},Mt=function(e){return' ("undefined" !== typeof('+e+")) "},It=function(e){e=e.split(",");var t=c(e.shift()),n=c(e.join(","));return"';"+J+wt(t+" = ("+n+");")+J},xt=function(e){return e&&e.length?(e=c(e),"';"+J+wt('if ("undefined" !== typeof ('+e+")) delete "+e+";")+J):"'; "+J},kt=function(e){var t="';"+wt(sn({IFCOND:e}));return nt++,Z++,t},Lt=function(e){Z--;var t="';"+wt(cn({ELIFCOND:e}));return Z++,t},Ut=function(){Z--;var e="';"+wt(fn());return Z++,e},Ft=function(){nt--,Z--;var e="';"+wt(dn());return e},Ht=function(e){e=e.split(" as ");var t,n=c(e[0]),r="_O"+ ++et,u=e[1].split("=>"),i=u.length>=2;if(i){var o=c(u[0])+"__RAW__",l=c(u[1])+"__RAW__",a="_K"+ ++et,s="_V"+ ++et;t="';"+wt(pn({O:n,_O:r,K:o,_K:a,V:l,_V:s,ASSIGN1:"__i__.d['"+o+"'] = "+a+"; __i__.d['"+l+"'] = "+s+" = "+r+"["+a+"];"},2)),ut=2,Z+=3}else{var l=c(u[0])+"__RAW__",a="_K"+ ++et,f="_L"+ ++et,s="_V"+ ++et;t="';"+wt(pn({O:n,_O:r,_K:a,_L:f,V:l,_V:s,ASSIGN1:"__i__.d['"+l+"'] = "+s+" = "+r+"["+a+"];"},1)),ut=1,Z+=2}return tt++,rt++,t},Rt=function(){var e;return 2===ut?(rt--,Z+=-3,e="';"+wt(_n(null,2)),Z+=1):(rt--,Z+=-2,e="';"+wt(_n(null,1)),Z+=1),e},Kt=function(){var e;return rt===tt?2===ut?(tt--,rt--,Z+=-3,e="';"+wt(gn(null,3))):(tt--,rt--,Z+=-2,e="';"+wt(gn(null,2))):(tt--,Z+=-1,e="';"+wt(gn(null,1))),e},Pt=function(e){return K[e]||(At(),Tt(),K[e]=" "+Zt(Nt(jt(e)),!1)+"'; "+J,yt()),wt(K[e])},Bt=function(e){e=e.split(",");var t=c(e.shift()),n=e.join(",");return"' + %tpl( \""+t+'", '+n+" ); "+J},$t=function(e){return ft=c(e),"'; "+J},Gt=function(e){return e=c(e),it.push([e,-1,-1,0,lt[0][1]]),ot[e]=ot[e]?ot[e]+1:1,ct=it.length,lt.unshift([e,ct-1]),at=e,st=null,"' +  __||"+e+"||__"},Yt=function(){if(1<lt.length){var e=lt.shift();return st=e[0],ct=e[1]+1,at=null,"__||/"+e[0]+"||__"}return""},qt=function(e,t,n){var r,u,i,o,l;for(r=e.split(t),u=r.length,i=[],o=0;u>o;o++)l=r[o].split(n),i.push(l[0]),l.length>1&&i.push(l[1]);return i},zt=function(e,t,n){if(t)switch(n=n||"",t){case"isset":return n=n.replace(Ot.controls2,zt),Mt(n);case"set":return n=n.replace(Ot.controls2,zt),It(n);case"unset":return n=n.replace(Ot.controls2,zt),xt(n);case"if":return n=n.replace(Ot.controls2,zt),kt(n);case"elseif":return n=n.replace(Ot.controls2,zt),Lt(n);case"else":return Ut(n);case"endif":return Ft(n);case"for":return n=n.replace(Ot.controls2,zt),Ht(n);case"elsefor":return Rt(n);case"endfor":return Kt(n);case"extends":return $t(n);case"block":return Gt(n);case"endblock":return Yt(n);case"template":return n=n.replace(Ot.controls2,zt),Bt(n);case"include":return Pt(n)}return e},Vt=function(e){for(var t,n,r,u,i,o,l,a,s,c,f={},d=it.length;d--;)n=it[d],t=n[0],l=n[1],a=n[2],s=n[3],c=n[4],r="__||"+t+"||__",u="__i__.renderBlock( '"+t+"' ); ",i=r.length,o=u.length,c>-1&&(it[c][3]+=o-(a-l+1)),a+=s,1===ot[t]&&(f[t]=an({BLOCKCODE:e.slice(l+i,a-i-1)+"';"})),e=e.slice(0,l)+u+e.slice(a+1),1<=ot[t]&&ot[t]--;return it=null,ot=null,lt=null,[e,f]},Jt=function(e,t,n,r){for(var u=t,i=!1,o="";r>n&&(o=e[n++],u+=o,t!==o||i);)i=!i&&"\\"===o;return u},Wt=function(e,t,n,r){if(r=r||"VARSTR",gt.test(e[t])){var u,i,o,l,a,s,c,f,d,p,_,g=0,h={},m=[],v=0;for(i=e[t++];n>t&&mt.test(e[t]);)i+=e[t++];for(l=i,i="__i__.d['"+i+"']",a=l.length,v=0;n>t&&vt.test(e[t]);)v++,t++;for(c=0;n>t&&("."===e[t]||"["===e[t]);){for(f=e[t++];n>t&&vt.test(e[t]);)v++,t++;if("."===f){for(o="";n>t&&mt.test(e[t]);)o+=e[t++];if(s=o.length,!s)break;i+="['"+o+"']",a+=v+1+s,v=0}else if("["===f){if(c++,d=e[t],'"'===d||"'"===d)o=Jt(e,d,t+1,n),g++,p="__##"+r+g+"##__",h[p]=o,i+=f+p,s=o.length,t+=s,a+=v+1+s,v=0;else if(ht.test(d)){for(o=e[t++];n>t&&ht.test(e[t]);)o+=e[t++];i+=f+o,s=o.length,a+=v+1+s,v=0}else if("$"===d)_=e.slice(t+1),u=Wt(_,0,_.length,r+"_"+g+"_"),u&&(o=u[u.length-1],i+=f+o[0][0],s=o[1],t+=s+1,a+=v+2+s,v=0,m=m.concat(u));else{if("]"!==d)break;if(!(c>0))break;c--,i+=f+e[t++],a+=v+2,v=0}for(;n>t&&vt.test(e[t]);)v++,t++;if("]"===e[t]){if(!(c>0))break;c--,i+=e[t++],a+=v+1,v=0}}for(;n>t&&vt.test(e[t]);)v++,t++}return m.push([[i,l],a,h]),m}return null},Xt=function(e,t,n){return n&&bt[n]?"Contemplate.plugin_"+n:"Contemplate."+t},Zt=function(e,t){var n,r,u,i,o,l,a,s,c,f,d,p,g,h,m,v,O,E;for(n=qt(e,B,$),r=n.length,l=!1,u="",o=0;r>o;o++){if(i=n[o],l){for(a="	"+i.replace(Ot.specials," ")+"",d=a.length,c={},s={},p=0,g="",h="",m=0;d>p;)if(g=a[p++],'"'===g||"'"===g)v=Jt(a,g,p,d),m++,f="__##STR"+m+"##__",s[f]=v,h+=f,p+=v.length-1;else if("$"===g)if(v=Wt(a,p,d)){for(O=0;O<v.length;O++)E=v[O],m++,f="__##VAR"+m+"##__",c[f]=E[0],s=_.merge(s,E[2]);h+=f,p+=E[1]}else h+="$";else h+=g;a=h,at=null,st=null,ct=-1,a=a.replace(Ot.controls,zt).replace(Ot.functions,Xt).replace(Ot.replacements,"' + ( $1 ) + '");for(f in c)a=a.split(f+"__RAW__").join(c[f][1]),a=a.split(f).join(c[f][0]);for(f in s)a=a.split(f).join(s[f]);i=a.split("	").join(G).split("").join(wt(Y)),at?(at="__||"+at+"||__",it[ct-1][1]=u.length+a.indexOf(at)):st&&(st="__||/"+st+"||__",it[ct-1][2]=u.length+a.indexOf(st)+st.length),l=!1}else W&&(i=i.split("\\").join("\\\\")),i=i.split("'").join("\\'").split(/\n/).join(V),l=!0;u+=i}return!1!==t?Vt(u):u},Qt=function(e){return F+e.replace(pt,"_")+"_tpl.js"},en=function(e){return"Contemplate_"+e.replace(pt,"_")+"_Cached"},tn=function(e,t){Tt();var n,r,u=Zt(Nt(jt(e),t)),i={};r=ft?hn(null,1):hn({FCODE:"__p__ += '"+u[0]+"';"},2);for(n in u[1])i[n]=new Function("Contemplate,__i__",u[1][n]);return[new Function("Contemplate,__i__",r),i]},nn=function(e,t,n,r){Tt();var u,i,o,l,a,s,c=Zt(Nt(jt(e),r));a=[];for(l in c[1])s=J+ln({BLOCKNAME:l,BLOCKMETHODNAME:l,BLOCKMETHODCODE:wt(c[1][l],1)}),a.push(s);a=a.length?J+"_blocks = { "+J+wt(a.join(","+J),1)+J+"};"+J:"",ft?(i="this.extend( '"+ft+"' );",o=mn(null,1)):(i="",o=mn({RCODE:"__p__ += '"+c[0]+"';"},2)),u=q?q:"";var f=on({CLASSNAME:n,TPLID:e,PREFIXCODE:u,EXTENDCODE:wt(i,2),BLOCKS:wt(a,2),RENDERCODE:wt(o,4)});return un(t,f)},rn=function(e,t){if(t=t||{},P[e]){var n=tn(e,t.separators),r=vn(_,e,n[0]).setBlocks(n[1]);return ft&&r.extend(_.tpl(ft)),r}if(b||(U=_.CACHE_TO_DISK_NONE),!0!==t.autoUpdate&&_.CACHE_TO_DISK_NOUPDATE===U){var u=Qt(e),i=en(e);if(w(u)||nn(e,u,i,t.separators),w(u)){var o=require(u)(_),r=(new o).setId(e);return r}return null}if(!0===t.autoUpdate||_.CACHE_TO_DISK_AUTOUPDATE===U){var u=Qt(e),i=en(e);if(w(u)){var l=D(u),a=D(R[e]);l.mtime.getTime()<=a.mtime.getTime()&&nn(e,u,i,t.separators)}else nn(e,u,i,t.separators);if(w(u)){var o=require(u)(_),r=(new o).setId(e);return r}return null}var n=tn(e,t.separators),r=vn(_,e,n[0]).setBlocks(n[1]);return ft&&r.extend(_.tpl(ft)),r},un=function(e,t,n){return n?(N(e,t,{encoding:_.ENCODING},function(e){n(!e)}),void 0):y(e,t,{encoding:_.ENCODING})},on=function(e){var t=St;return[e.PREFIXCODE,t("","!function (root, moduleName, moduleDefinition) {","","    //","    // export the module","","    // node, CommonJS, etc..","    if ( 'object' === typeof(module) && module.exports ) module.exports = moduleDefinition();","","    // AMD, etc..","    else if ( 'function' === typeof(define) && define.amd ) define( moduleDefinition );","","    // browser, etc..","    else root[ moduleName ] = moduleDefinition();","","","}(this, '"),e.CLASSNAME,t("', function( ) {",'    "use strict";',"    return function( Contemplate ) {","    /* Contemplate cached template '"),e.TPLID,t("' */","    /* quasi extends main Contemplate class */","    ","    /* constructor */","    function "),e.CLASSNAME,t("(id)","    {","        /* initialize internal vars */","        var _extends = null, _blocks = null;","        ","        this.id = id;","        this.d = null;","        ","        ","        /* tpl-defined blocks render code starts here */",""),e.BLOCKS,t("","        /* tpl-defined blocks render code ends here */","        ","        /* template methods */","        ","        this.setId = function(id) {","            if ( id ) this.id = id;","            return this;","        };","        ","        this.extend = function(tpl) {","            if ( tpl && tpl.substr )","                _extends = Contemplate.tpl( tpl );","            else","                _extends = tpl;","            return this;","        };","        ","        /* render a tpl block method */","        this.renderBlock = function(block, __i__) {","            if ( !__i__ ) __i__ = this;","            if ( _blocks && _blocks[block] ) return _blocks[block](__i__);","            else if ( _extends ) return _extends.renderBlock(block, __i__);","            return '';","        };","        ","        /* tpl render method */","        this.render = function(data, __i__) {","            if ( !__i__ ) __i__ = this;","            var __p__ = '';","            if ( _extends )","            {","                __p__ = _extends.render(data, __i__);","            }","            else","            {","                /* tpl main render code starts here */",""),e.RENDERCODE,t("","                /* tpl main render code ends here */","            }","            this.d = null;","            return __p__;","        };","        ","        /* extend tpl assign code starts here */",""),e.EXTENDCODE,t("","        /* extend tpl assign code ends here */","    };","    ","    ","    // export it","    return "),e.CLASSNAME,t(";","    };","});","")].join("")},ln=function(e){var t=St;return[t("","/* tpl block render method for block '"),e.BLOCKNAME,t("' */","'"),e.BLOCKMETHODNAME,t("': function(__i__) {",""),e.BLOCKMETHODCODE,t("","}","")].join("")},an=function(e){var t=St;return[t("","var __p__ = '';",""),e.BLOCKCODE,t("","return __p__;","")].join("")},sn=function(e){var t=St;return[t("","if ( "),e.IFCOND,t(" )","{","")].join("")},cn=function(e){var t=St;return[t("","}","else if ( "),e.ELIFCOND,t(" )","{","")].join("")},fn=function(){var e=St;return e("","}","else","{","")},dn=function(){var e=St;return e("","}","")},pn=function(e,t){var n=St;return 2===t?[n("","var "),e._O," = ",e.O,n(";","if ("),e._O," && Object.keys(",e._O,n(").length)","{","    var "),e._K,", ",e._V,n(";","    for ("),e._K," in ",e._O,n(")","    {","        if (Contemplate.hasOwn("),e._O,", ",e._K,n("))","        {","            "),e.ASSIGN1,n("","            ","")].join(""):[n("","var "),e._O," = Contemplate.values(",e.O,n(");","if ("),e._O," && ",e._O,n(".length)","{","    var "),e._K,", ",e._V,", ",e._L," = ",e._O,".length",n(";","    for ("),e._K,"=0; ",e._K,"<",e._L,"; ",e._K,n("++)","    {","        "),e.ASSIGN1,n("","        ","")].join("")},_n=function(e,t){var n=St;return 2===t?n("","        }","    }","}","else","{  ",""):n("","    }","}","else","{  ","")},gn=function(e,t){var n=St;return 3===t?n("","        }","    }","}",""):2===t?n("","    }","}",""):n("","}","")},hn=function(e,t){var n=St;return 1===t?"return '';":[n("","var __p__ = '';",""),e.FCODE,n("","return __p__;","")].join("")},mn=function(e,t){var n=St;return 1===t?"__p__ = '';":[n("","__i__.d = Contemplate.data( data );",""),e.RCODE,n("","")].join("")},vn=function(e,t,n){var r=function(t,n){var r=null,u=null,i=null;this.id=null,this.d=null,t&&(this.id=t,r=n),this.setId=function(e){return e&&(this.id=e),this},this.extend=function(t){return u=t&&t.substr?e.tpl(t):t,this},this.setRenderFunction=function(e){return r=e,this},this.setBlocks=function(t){return i||(i={}),i=e.merge(i,t),this},this.renderBlock=function(t,n){return n||(n=this),i&&i[t]?i[t](e,n):u?u.renderBlock(t,n):""},this.render=function(t,n){var i="";return n||(n=this),u?i=u.render(t,n):r&&(n.d=e.data(t),i=r(e,n)),this.d=null,i}};return new r(t,n)};return _={VERSION:g,CACHE_TO_DISK_NONE:0,CACHE_TO_DISK_AUTOUPDATE:2,CACHE_TO_DISK_NOUPDATE:4,ENCODING:"utf8",init:function(){I||(X=[],Ot.specials=new RegExp("[\\n\\r\\v\\t]","g"),Ot.replacements=new RegExp("\\t[ ]*(.*?)[ ]*\\v","g"),Ot.controls=new RegExp("\\t[ ]*%("+Et.join("|")+")\\b[ ]*\\((.*)\\)","g"),Ot.controls2=new RegExp("%("+Et.join("|")+")\\b[ ]*\\((.*)\\)","g"),Ot.functions=new RegExp("%("+Ct.join("|")+")\\b","g"),V=z,G="'; "+J,Y=J+"__p__ += '",I=!0)},addPlugin:function(e,t){e&&t&&(bt[e]=!0,_["plugin_"+e]=t)},setPrefixCode:function(e){e&&(q=""+e)},setLocaleStrings:function(e){x=_.merge(x,e)},clearLocaleStrings:function(){x={}},setPlurals:function(e){if(e){for(var t in e)null==e[t]&&(e[t]=t+"s");k=_.merge(k,e)}},clearPlurals:function(){k={}},setTemplateSeparators:function(e){e&&(e.left&&(B=""+e.left),e.right&&($=""+e.right))},setPreserveLines:function(e){arguments.length<1&&(e=!0),V=e?z:""},setCacheDir:function(e){F=s(e,"/")+"/"},setCacheMode:function(e){U=b?e:_.CACHE_TO_DISK_NONE},setSyncMode:function(e){L=!e},clearCache:function(e){H={},e&&(K={})},add:function(e,t){if("object"==typeof e){for(var n in e)T(e[n])&&(e[n][0]&&(P[n]=e[n][0]),delete e[n]);R=_.merge(R,e)}else e&&t&&(R[e]=t)},addInline:function(e,t){"object"==typeof e?P=_.merge(P,e):e&&t&&(P[e]=t)},tpl:function(e,t,n){n=Dt({autoUpdate:!1,refresh:!1,escape:!0,separators:null},n),W=!1===n.escape?!1:!0,(n.refresh||!H[e])&&(H[e]=rn(e,n));var r=H[e];return t&&"object"==typeof t?r.render(t):r},html:function(e){return n(e,"ENT_COMPAT","UTF-8")},url:r,count:u,haskey:function(t){var n=O(t);if(!t||"[object Array]"!=n&&"[object Object]"!=n)return!1;var r,u,i,o=C(arguments);for(o.shift(),r=o.length,i=t,u=0;r>u;u++){if(e===i[o[u]])return!1;i=i[o[u]]}return!0},q:function(e){return"'"+e+"'"},dq:function(e){return'"'+e+'"'},s:function(e){return String(""+e)},n:function(e){return parseInt(e,10)},f:function(e){return parseFloat(e,10)},addslashes:function(e){return(e+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},stripslashes:function(e){return(e+"").replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return t}})},concat:function(){return C(arguments).join("")},trim:c,ltrim:a,rtrim:s,ucfirst:function(e){return e[0].toUpperCase()+e.substr(1)},lcfirst:function(e){return e[0].toLowerCase()+e.substr(1)},lowercase:function(e){return e.toLowerCase()},uppercase:function(e){return e.toUpperCase()},camelcase:function(e,t,n){return t=t||"_",n?e.split(t).map(_.ucfirst).join(""):_.lcfirst(e.split(t).map(_.ucfirst).join(""))},snakecase:function(e,t){return t=t||"_",e.replace(/([A-Z])/g,t+"$1").toLowerCase()},sprintf:l,time:f,date:function(e,t){return t||(t=f()),d(e,t)},ldate:function(e,t){return t||(t=f()),p(x,e,t)},locale:function(e){return E(x,e)?x[e]:e},pluralise:function(e,t){return k[e]?1!==t?k[e]:e:e},uuid:function(e){return[e||"UUID",++dt,f()].join("_")},htmltable:function(e,t){e=_.merge({},e),t=_.merge({},t||{});var n,r,u,o,l,a,s,c,f,d="",p="",g="",h="",m=[],v=!1;if(d="<table",t.id&&(d+=" id='"+t.id+"'"),t["class"]&&(d+=" class='"+t["class"]+"'"),t.style&&(d+=" style='"+t.style+"'"),t.data)for(n in t.data)_.hasOwn(t.data,n)&&(d+=" data-"+n+"='"+t.data[n]+"'");d+=">",p="",(t.header||t.footer)&&(p="<td>"+(_.keys(e)||[]).join("</td><td>")+"</td>"),g="",t.header&&(g="<thead><tr>"+p+"</tr></thead>"),h="",t.footer&&(h="<tfoot><tr>"+p+"</tr></tfoot>"),d+=g,m=[],l=_.values(e)||[];for(r in l)if(_.hasOwn(l,r))for(a=l[r],i(a)||(a=[a]),s=_.values(a)||[],u=0,o=s.length;o>u;u++)m[u]||(m[u]=new Array(o)),m[u][r]=s[u];for(c=t.odd?t.odd:"odd",f=t.even?t.even:"even",v=!1,r=0,o=m.length;o>r;r++)d+=v?"<tr class='"+c+"'><td>"+m[r].join("</td><td>")+"</td></tr>":"<tr class='"+f+"'><td>"+m[r].join("</td><td>")+"</td></tr>",v=!v;return m=null,d+=h,d+="</table>"},htmlselect:function(e,t){e=_.merge({},e),t=_.merge({},t||{});var n,r,u,l,a="";if(a="<select",t.multiple&&(a+=" multiple"),t.disabled&&(a+=" disabled='disabled'"),t.name&&(a+=" name='"+t.name+"'"),t.id&&(a+=" id='"+t.id+"'"),t["class"]&&(a+=" class='"+t["class"]+"'"),t.style&&(a+=" style='"+t.style+"'"),t.data)for(n in t.data)_.hasOwn(t.data,n)&&(a+=" data-"+n+"='"+t.data[n]+"'");a+=">",t.selected?(i(t.selected)||(t.selected=[t.selected]),t.selected=o(t.selected)):t.selected={},t.optgroups&&(i(t.optgroups)||(t.optgroups=[t.optgroups]),t.optgroups=o(t.optgroups));for(n in e)if(_.hasOwn(e,n))if(u=e[n],t.optgroups&&t.optgroups[n]){a+="<optgroup label='"+n+"'>";for(r in u)_.hasOwn(u,r)&&(l=u[r],t.use_key?l=r:t.use_value&&(r=l),a+=_.hasOwn(t.selected,r)?"<option value='"+r+"' selected='selected'>"+l+"</option>":"<option value='"+r+"'>"+l+"</option>");a+="</optgroup>"}else t.use_key?u=n:t.use_value&&(n=u),a+=t.selected[n]?"<option value='"+n+"' selected='selected'>"+u+"</option>":"<option value='"+n+"'>"+u+"</option>";return a+="</select>"},getTemplateContents:jt,hasOwn:function(e,t){return e&&E(e,t)},keys:function(e){return e?Object.keys(e):null},values:function(e){if(e){if(e instanceof Array)return e;var t,n=[];for(t in e)E(e,t)&&n.push(e[t]);return n}return null},items:function(e){return e?e:null},merge:Dt,data:function(e){if(T(e))return e.slice();var t,n,r={};for(t in e)E(e,t)&&(n=t,r[n]=e[t]);return r}},_.now=_.time,_.l=_.locale,_.init(),_});

/**
*
*   Dromeo
*   Simple and Flexible Routing Framework for PHP, Python, Node/JS
*   @version: 0.5
*
*   https://github.com/foo123/Dromeo
*
**/
!function(e,t,n){"object"==typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):e[t]=n()}(this,"Dromeo",function(e){"use strict";function t(e,t,n){var r=this;r.handlers=[],r.route=e,r.pattern=t,r.captures=n,r.dispose=function(){return r.handlers=null,r.route=null,r.pattern=null,r.captures=null,r}}var n="0.5",r={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",419:"Authentication Timeout",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",440:"Login Timeout",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request Header Too Large",495:"Cert Error",496:"No Cert",497:"HTTP to HTTPS",498:"Token expired/invalid",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Origin Error",521:"Web server is down",522:"Connection timed out",523:"Proxy Declined Request",524:"A timeout occurred",598:"Network read timeout error",599:"Network connect timeout error"},o=/^([a-zA-Z0-9-_]+\|[a-zA-Z0-9-_|]+)$/,i=/\((\d+)\)$/,l=Object.prototype,a=Array.prototype,s=Function.prototype,u=s.call.bind(l.hasOwnProperty),c=s.call.bind(l.toString),h=s.call.bind(a.slice),d="undefined"!=typeof global&&"[object global]"==c(global),f=function(e){return"[object Function]"===c(e)||e instanceof Function},p=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},g=function(e){return e.length>0},m=function(e){return e.replace(/([*+\[\]\(\)?^$\/\\:])/g,"\\$1")},_={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},y=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],R=function(e,t,n){for(var r=_[n||"php"].exec(e),o={},i=14;i--;)r[i]&&(o[y[i]]=r[i]);return"port"in o&&(o.port=parseInt(o.port,10)),t?o[t.replace("PHP_URL_","").toLowerCase()]||null:(o.source&&delete o.source,o)},b=function(e){return decodeURIComponent(""+e)},v=function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},A=function(e){return v(e).split("%20").join("+")},P=function(t){var n,r,o,i,l,a,s,c,h,d,f,g,m,_=t.replace(/^&/,"").replace(/&$/,"").split("&"),y=_.length,R={};for(n=0;y>n;n++)if(c=_[n].split("="),h=b(p(c[0])),d=c.length<2?"":b(p(c[1])),r=h.indexOf("\x00"),r>-1&&(h=h.slice(0,r)),h&&"["!==h.charAt(0)){for(g=[],f=0,r=0;r<h.length;r++)if("["!==h.charAt(r)||f){if("]"===h.charAt(r)&&f&&(g.length||g.push(h.slice(0,f-1)),g.push(h.substr(f,r-f)),f=0,"["!==h.charAt(r+1)))break}else f=r+1;for(g.length||(g=[h]),r=0;r<g[0].length&&(s=g[0].charAt(r),(" "===s||"."===s||"["===s)&&(g[0]=g[0].substr(0,r)+"_"+g[0].substr(r+1)),"["!==s);r++);for(a=R,r=0,m=g.length;m>r;r++)if(h=g[r].replace(/^['"]/,"").replace(/['"]$/,""),l=a,""!==h&&" "!==h||0===r)e===a[h]&&(a[h]={}),a=a[h];else{o=-1;for(i in a)u(a,i)&&+i>o&&i.match(/^\d+$/g)&&(o=+i);h=o+1}l[h]=d}return R},q=function(e,t,n,r){var o,i,l=r?v:A;if(!0===t?t="1":!1===t&&(t="0"),null!=t){if("object"==typeof t){i=[];for(o in t)null!=t[o]&&i.push(q(e+"["+o+"]",t[o],n,r));return i.join(n)}return l(e)+"="+l(t)}return""},N=function(e,t,n){var r,o,i,l=[];arguments.length<2&&(t="&"),arguments.length<3&&(n=!1);for(o in e)r=e[o],i=q(o,r,t,n),""!=i&&l.push(i);return l.join(t)},L=function(e,t,n){if(n){var r,o,i=[];for(e=e.split(t),o=0;o<e.length;o++)r=e[o],r=r.split(n),i.push(r[0]),r.length>1&&i.push(r[1]);return i}return e.split(t)},T=function(e,t,n){var r,i,l,a,s,u=0;for(n=L(n,e[3]),a=[],i=n.length,l=!1,r=0;i>r;r++)l?(n[r].length&&(t[n[r]]?(a.push("("+t[n[r]]+")"),u++):(s=n[r].match(o))?(a.push("("+s[1].split("|").filter(g).map(m).join("|")+")"),u++):a.push(m(n[r]))),l=!1):(n[r].length&&a.push(m(n[r])),l=!0);return 1===a.length&&1===u?[a.join(""),u]:["("+a.join("")+")",u+1]},w=function(e,n,r){var o,l,a,s,u,c,h,d,f,g,_,y,R,b,v;for(o=L(r,e[0],e[1]),s=o.length,h=!1,d="",_=0,y={},a=0;s>a;a++)l=o[a],h?(u=!1,c=!1,f=l.split(e[2]),b=T(e,n,f[0]),f.length>1&&(R=p(f[1]),u=R.length&&"?"===R.charAt(0),u&&(R=R.slice(1)),(g=R.match(i))?(R=R.slice(0,-g[0].length),v=parseInt(g[1],10),v>=0&&v<b[1]?v+=_+1:v=_+1):v=_+1,c=R.length>0),d+=b[0],_+=b[1],u&&(d+="?"),c&&(y[R]=v),h=!1):(d+=m(l),h=!0);return new t(r,new RegExp("^"+d+"$"),y)},j=function(e,t,n){delete e[n];var r,o=t.length;for(r=o-1;r>=0;r--)if(n===t[r].route){t.splice(r,1);break}},k=function(e,t,n,r,o,i,l,a){o&&o.length&&i&&"function"==typeof i&&(a=!0===a,l=l||{},o in e?e[o].handlers.push([i,l,a]):(e[o]=w(n,r,o),e[o].handlers.push([i,l,a]),t.push(e[o])))},C=function(){var e=this;e._delims=["{","}",":","%"],e._patterns={},e.definePattern("ALPHA","[a-zA-Z\\-_]+"),e.definePattern("NUMBR","[0-9]+"),e.definePattern("ALNUM","[a-zA-Z0-9\\-_]+"),e.definePattern("QUERY","\\?[^?#]+"),e.definePattern("FRAGM","#[^?#]+"),e.definePattern("ALL",".+"),e._handlers=[],e._routes=[],e._fallback=!1};return C.VERSION=n,C.Route=t,C.prototype={constructor:C,_delims:null,_patterns:null,_handlers:null,_routes:null,_fallback:!1,dispose:function(){var e,t=this;t._delims=null,t._patterns=null,t._routes=null,t._fallback=null;for(e in t._handlers)t._handlers[e].dispose();return t._handlers=null,t},reset:function(){return this._handlers={},this._routes=[],this._fallback=!1,this},defineDelimiters:function(e){var t,n=this;return e&&(t=e.length,t>0&&e[0]&&(n._delims[0]=e[0]),t>1&&e[1]&&(n._delims[1]=e[1]),t>2&&e[2]&&(n._delims[2]=e[2]),t>3&&e[3]&&(n._delims[3]=e[3])),n},definePattern:function(e,t){return this._patterns[e]=t,this},dropPattern:function(e){return e in this._patterns&&delete this._patterns[e],this},parse:function(e,t,n){var r={};return e&&(arguments.length<3&&(n="fragment_params"),arguments.length<2&&(t="query_params"),r=R(e),t&&(r[t]=r.query?this.unglue(r.query):{}),n&&(r[n]=r.fragment?this.unglue(r.fragment):{})),r},unglue:function(e){var t;return t=e?P(e):{}},build:function(e,t,n,r,o){var i=""+e;return arguments.length<5&&(o="#"),arguments.length<4&&(r="?"),t&&(i+=r+this.glue(t)),n&&(i+=o+this.glue(n)),i},glue:function(e){var t="";return e&&(t+=N(e,"&",!0)),t},redirect:function(e,t,n,o){return e&&(d?t&&(arguments.length<3&&(n=302),arguments.length<4&&(o=!0),o?(!0===o&&(o=r[n]||""),t.writeHead(n,o,{Location:e})):t.writeHead(n,{Location:e}),t.end()):document.location.href=e),this},on:function(){var e,t,n,r=this,o=h(arguments),i=o.length;if(i>=2)e=o,n=e[2]||null,k(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n);else if(1===i&&o[0]instanceof Array)for(o=o[0],i=o.length,t=0;i>t;t++)e=o[t],e.length>=2&&(n=e[2]||null,k(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n));return r},one:function(){var e,t,n,r=this,o=h(arguments),i=o.length;if(i>=2)e=o,n=e[2]||null,k(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n,!0);else if(1===i&&o[0]instanceof Array)for(o=o[0],i=o.length,t=0;i>t;t++)e=o[t],e.length>=2&&(n=e[2]||null,k(r._handlers,r._routes,r._delims,r._patterns,e[0],e[1],n,!0));return r},off:function(e,t){var n,r,o,i=this,l=i._routes,a=i._handlers;if(e&&e in a)if(t&&f(t)){for(r=a[e],o=r.handlers.length,n=o-1;n>=0;n--)t===r.handlers[n][0]&&r.handlers.splice(n,1);r.handlers.length||j(a,l,e)}else j(a,l,e);return i},fallback:function(e){return 1>arguments.length&&(e=!1),(!1===e||null===e||f(e))&&(this._fallback=e),this},route:function(e){var t,n,r,o,i,l,a,s,u,c,h,d,f=this,p=f._routes;if(e)for(o=p.length,r=0;o>r;r++)if(t=p[r],a=e.match(t.pattern)){for(c=t.handlers.slice(0),d=[],i=c.length,l=0;i>l;l++)c[l][2]&&d.push(l);for(i=d.length;--i>=0;)t.handlers.splice(d.pop(),1);for(i=c.length,l=0;i>l;l++){h=c[l],n={};for(s in t.captures)u=t.captures[s],n[s]=a[u]?a[u]:s in h[1]?h[1][s]:null;h[0](e,n)}return!0}return f._fallback?(f._fallback(e,!1),!1):!1}},C});

/**
*
*   ModelView.js
*   @version: 0.21
*   @dependencies: jQuery
*
*   A micro-MV* (MVVM) jQuery-based framework for complex (UI) screens
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n,i,r){"use strict";n=n?[].concat(n):[];var a,o,u=Array,l=u.prototype,s=n.length,c=new u(s);if("object"==typeof module&&module.exports){if(r===module.exports[t]){for(a=0;s>a;a++)c[a]=module.exports[n[a][0]]||require(n[a][1])[n[a][0]];o=i.apply(e,c),module.exports[t]=o||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(n.map(function(e){return e[1]})),function(a){if(r===a[t]){var u,s=l.slice.call(arguments,1),f=s.length;for(u=0;f>u;u++)c[u]=a[n[u][0]]||s[u];o=i.apply(e,c),a[t]=o||1}});else if(r===e[t]){for(a=0;s>a;a++)c[a]=e[n[a][0]];o=i.apply(e,c),e[t]=o||1}}(this,"ModelView",[["jQuery","jquery"]],function(e){var t={};return!function(e,t,n){"use strict";var i=Array.prototype,r=Object.prototype,a=Function.prototype,o=a.call.bind(r.hasOwnProperty),u=a.call.bind(r.toString),l=a.call.bind(i.slice),s=Object.keys,c=(Math.random,2),f=3,d=4,h=8,p=9,m=16,v=32,g=64,b=128,$=256,y=512,_=1024,E={options:1,html:2,text:3,"class":4,value:5,checked:6,disabled:7},k=function(e){var t=typeof e,i=u(e);return n===e||"undefined"===t?y:"number"===t||e instanceof Number?isNaN(e)?f:c:null===e?$:!0===e||!1===e?d:"string"===t||e instanceof String?1===e.length?p:h:"[object Array]"===i||e instanceof Array?m:"[object RegExp]"===i||e instanceof RegExp?b:"function"===t&&"[object Function]"===i||e instanceof Function?g:"[object Object]"===i?v:_},C=Object.create,O=function(){var e,t,n,i,r,a,o,u=l(arguments);for(t=u.shift()||{},e=u.length,a=0;e>a;a++)if(n=u[a],v===k(n))for(r in n)i=n[r],o=k(i),t[r]=c&o?0+i:(h|m)&o?i.slice(0):i;return t},w=function(e,t){return!!(t&k(e))},A=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},R=function(e){return A(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},L=function(e,t){return n!==e.attr(t)},T=function(e,t){return t===e.substr(0,t.length)},N=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},I=function(e,t){return t.replace(new RegExp("^"+e+"([\\.|\\[])"),"$1")},V=function(e){return"["+e+"]"},x=function(e,t){return null==e?n:(e=""+e,t?e.replace(/\.+$/,"").replace(/^\./,"").split(".").map(V).join(""):e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\./,"").replace(/\.+$/,""))},S=JSON.parse,M=JSON.stringify,j=t.extend,D=function(){return(new Date).getTime()},H=function(e,t,n){for(var i,r=n;t.length;)i=t.shift(),i in r||(r[i]={value:null,next:{}}),t.length?r=r[i].next:r[i].value=e;return n},F=function(e,t){if(!e)return null;var n,i=[],r=e.length;for(n=0;r>n;n++)e[n]&&(e[n][t]&&i.push(e[n][t].next),e[n]["*"]&&i.push(e[n]["*"].next));return i.length?i:null},P=function(e,t){if(!e)return null;var n,i=e.length;if(t){for(n=0;i>n;n++)if(e[n]){if(e[n][t]&&w(e[n][t].value,g))return e[n][t].value;if(e[n]["*"]&&w(e[n]["*"].value,g))return e[n]["*"].value}}else for(n=0;i>n;n++)if(e[n]&&w(e[n].value,g))return e[n].value;return null},z=function(e,t,n,i){for(var r,a,o=t,u=[n];e.length;){if(r=e.shift(),a=k(o),!e.length)return P(u,r)?!0:a&(v|m)&&r in o?!0:v===a&&"length"==r?!0:!1;if(a&(v|m)&&r in o){if(o=o[r],o instanceof i)return[i,o,e];u=F(u,r)}else if(u=F(u,r),!u)return!1}return!1},B=function(e,t,n,i){for(var r,a,o=t,u=[n];e.length;){if(r=e.shift(),a=k(o),!e.length)return(u=P(u,r))?[!1,u]:a&(v|m)&&r in o?[!0,o[r]]:v===a&&"length"==r?[!0,s(o).length]:!1;if(a&(v|m)&&r in o){if(o=o[r],o instanceof i)return[i,o,e];u=F(u,r)}else if(u=F(u,r),!u)return!1}return!1},W=function(e,t,n,i,r,a){for(var o,u,l=t,s=[n],c=[i],f=[r];e.length;)if(o=e.shift(),u=k(l),e.length){if(!(u&(v|m)&&o in l))return[!1,l,o,e,null,null,null];if(l=l[o],l instanceof a)return[a,l,e,0,null,null,null];s=F(s,o),c=F(c,o),f=F(f,o)}else if(u&(v|m))return l[o]instanceof a?[a,l[o],e,0,null,null,null]:o in l||u===v&&"length"===o?[!0,l,o,e,s,c,f]:[!1,l,o,e,s,c,f];return[!1,l,o,e,null,null,null]},U=function(e,t){var n=this,i=arguments.length;n.$store={},n.$size=1/0,n.$interval=1/0,i>0&&e>0&&(n.$size=e),i>1&&t>0&&(n.$interval=t)};U.prototype={constructor:U,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store[e]:null;return!!(n&&D()-n.time<=t.$interval)},get:function(e){if(e){var t=this,i=t.$store[e];if(i)return D()-i.time>t.$interval?(delete t.$store[e],n):i.data}return n},set:function(e,t){var n,i,r,a=this;if(e){for(n=a.$store,i=a.$size,r=s(n);r.length>=i;)delete n[r.shift()];n[e]={data:t,time:D()}}return a},del:function(e){return e&&this.$store[e]&&delete this.$store[e],this},toString:function(){return"[ModelView.Cache]"}};var J=0,Q="modelview",G=function(e){return[e||"UUID",++J,(new Date).getTime()].join("_")},Z=t.Event,q=function(e,t){var n=[e||"",Q];return t&&(n=n.concat(t)),n.join(".")},X={$PB:null,namespace:null,initPubSub:function(){return this.$PB=t({}),this},disposePubSub:function(){return this.$PB.off(q("")),this.$PB=null,this},trigger:function(e,t,n){return this.namespace&&(n=n?[this.namespace].concat(n):[this.namespace]),this.$PB.trigger(q(e,n),t),this},on:function(e,t,n){return w(t,g)&&(this.namespace&&(n=n?[this.namespace].concat(n):[this.namespace]),this.$PB.on(q(e,n),t)),this},onTo:function(e,t,n,i){return w(n,g)&&(n=n.bind(this)),e.on(t,n,i),this},off:function(e,t,n){return this.namespace&&(n=n?[this.namespace].concat(n):[this.namespace]),w(t,g)?this.$PB.off(q(e,n),t):this.$PB.off(q(e,n)),this},offFrom:function(e,t,n,i){return w(n,g)&&(n=n.bind(this)),e.off(t,n,i),this}};X.publish=X.trigger,X.subscribe=X.on,X.unsubscribe=X.off,X.subscribeTo=X.onTo,X.unsubscribeFrom=X.offFrom;var Y=function(e){return e.BEFORE=function(t){return Y(function(){var n=l(arguments);return n[0]=e.apply(this,n),t.apply(this,n)})},e.AFTER=function(t){return Y(function(){var n=l(arguments);return n[0]=t.apply(this,n),e.apply(this,n)})},e},K=function(e){return e.NOT=function(){return K(function(){return!e.apply(this,l(arguments))})},e.AND=function(t){return K(function(){var n=l(arguments);return!(!e.apply(this,n)||!t.apply(this,n))})},e.OR=function(t){return K(function(){var n=l(arguments);return!(!e.apply(this,n)&&!t.apply(this,n))})},e.XOR=function(t){return K(function(){var n=l(arguments),i=e.apply(this,n);return r2=t.apply(this,n),!!(i&&!r2||r2&&!i)})},e},et={TypeCaster:Y,Cast:{EACH:function(e){var t=function(){return e};return t.MODELVIEW_COLLECTION_EACH=!0,t},FIELD:function(e){var t=!0;return e=j({},e||{}),Y(function(n){var i,r,a,o,u;if(t){for(i in e)r=e[i],r.MODELVIEW_COLLECTION_EACH?(e[i]=r().bind(this),e[i].MODELVIEW_COLLECTION_EACH=!0):e[i]=r.bind(this);t=!1}for(i in e)if(r=e[i],a=n[i],r.MODELVIEW_COLLECTION_EACH&&w(a,m)){for(o=a.length,u=0;o>u;u++)a[u]=r(a[u]);n[i]=a}else n[i]=r(a);return n})},DEFAULT:function(e){return Y(function(t){var n=k(t);return(y&n||h&n&&!N(t).length)&&(t=e),t})},BOOLEAN:Y(function(e){return!!e}),CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return Y(function(n){return e>n?n=e:n>t&&(n=t),n})},INTEGER:Y(function(e){return parseInt(e,10)}),FLOAT:Y(function(e){return parseFloat(e,10)}),TRIMMED:Y(function(e){return N(String(e))}),LCASE:Y(function(e){return String(e).toLowerCase()}),UCASE:Y(function(e){return String(e).toUpperCase()}),STRING:Y(function(e){return String(e)})},add:function(e,t){return w(e,h)&&w(t,g)&&(et.Cast[e]=Y(t)),et},del:function(e){return w(e,h)&&et.Cast[e]&&delete et.Cast[e],et},toString:function(){return"[ModelView.Type]"}},tt={Validator:K,Validate:{EACH:function(e){var t=function(){return e};return t.MODELVIEW_COLLECTION_EACH=!0,t},FIELD:function(e){var t=!0;return e=j({},e||{}),K(function(n){var i,r,a,o,u;if(t){for(i in e)r=e[i],r.MODELVIEW_COLLECTION_EACH?(e[i]=r().bind(this),e[i].MODELVIEW_COLLECTION_EACH=!0):e[i]=r.bind(this);t=!1}for(i in e)if(r=e[i],a=n[i],r.MODELVIEW_COLLECTION_EACH&&w(a,m)){for(o=a.length,u=0;o>u;u++)if(!r(a[u]))return!1}else if(!r(a))return!1;return!0})},NUMERIC:K(function(e){return A(e)}),NOT_EMPTY:K(function(e){return!!(e&&0<N(String(e)).length)}),EQUAL:function(e,t){return K(!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return K(!1!==t?function(t){return e!==t}:function(t){return e!=t})},EQUALTO:function(e,t){return e='this.get("'+e+'", true)',K(!1!==t?new Function("v","return ( "+e+" === v );"):new Function("v","return ( "+e+" == v );"))},NOT_EQUALTO:function(e,t){return e='this.get("'+e+'", true)',K(!1!==t?new Function("v","return ( "+e+" !== v );"):new Function("v","return ( "+e+" != v );"))},MATCH:function(e){return K(function(t){return e.test(t)})},NOT_MATCH:function(e){return K(function(t){return!e.test(t)})},GREATER_THAN:function(e,t){return K(!1!==t?function(t){return t>e}:function(t){return t>=e})},LESS_THAN:function(e,t){return K(!1!==t?function(t){return e>t}:function(t){return e>=t})},BETWEEN:function(e,t,n){if(e>t){var i=t;t=e,e=i}return K(!1!==n?function(n){return n>e&&t>n}:function(n){return n>=e&&t>=n})},NOT_BETWEEN:function(e,t,n){if(e>t){var i=t;t=e,e=i}return K(!1!==n?function(n){return e>n||n>t}:function(n){return e>=n||n>=t})},IN:function(){var e=l(arguments);return w(e[0],m)&&(e=e[0]),K(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=l(arguments);return w(e[0],m)&&(e=e[0]),K(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return w(e,h)&&w(t,g)&&(tt.Validate[e]=K(t)),tt},del:function(e){return w(e,h)&&tt.Validate[e]&&delete tt.Validate[e],tt},toString:function(){return"[ModelView.Validation]"}},nt=function(e,t,n,i,r,a){var o=this;return o instanceof nt?(o.id=e||G("Model"),o.namespace=o.id,o.$view=null,o.$types={},o.$validators={},o.$getters={},o.$setters={},void o.data(t||{}).types(n).validators(i).getters(r).setters(a).initPubSub().init()):new nt(e,t,n,i,r,a)};nt.prototype=O(C(Object.prototype),X,{constructor:nt,id:null,$view:null,$data:null,$types:null,$validators:null,$getters:null,$setters:null,_atomic:!1,$atom:null,dispose:function(e){var t=this;return t.$view=null,t.$data=null,t.$types=null,t.$validators=null,t.$getters=null,t.$setters=null,t._atomic=!1,t.$atom=null,e&&t.publish("dispose",{target:t}),t.disposePubSub(),t},init:function(e){var t=this;return t._atomic=!1,t.$atom=null,e&&t.publish("init",{target:t}),t},isValid:function(){return!0},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},type:function(e,t){var n,i,r=this,a=!1;if(null==e)return r;if(e=x(e),i=k(t),g&i)a=t.MODELVIEW_COLLECTION_EACH,a?(t=t().bind(r),t.MODELVIEW_COLLECTION_EACH=a):t=t.bind(r),H(t,e.split("."),r.$types);else if((v|m)&i)for(n in t)r.type(e+"."+n,t[n]);return r},types:function(e){var t=this;if(e&&w(e,v))for(var n in e)t.type(n,e[n]);return t},validator:function(e,t){var n,i,r=this,a=!1;if(null==e)return r;if(e=x(e),i=k(t),g&i)a=t.MODELVIEW_COLLECTION_EACH,a?(t=t().bind(r),t.MODELVIEW_COLLECTION_EACH=a):t=t.bind(r),H(t,e.split("."),r.$validators);else if((v|m)&i)for(n in t)r.validator(e+"."+n,t[n]);return r},validators:function(e){var t=this;if(e&&w(e,v))for(var n in e)t.validator(n,e[n]);return t},getter:function(e,t){var n,i,r=this;if(null==e)return r;if(e=x(e),i=k(t),g&i)H(t.bind(r),e.split("."),r.$getters);else if((v|m)&i)for(n in t)r.getter(e+"."+n,t[n]);return r},getters:function(e){var t=this;if(e&&w(e,v))for(var n in e)t.getter(n,e[n]);return t},setter:function(e,t){var n,i,r=this;if(null==e)return r;if(e=x(e),i=k(t),g&i)H(t.bind(r),e.split("."),r.$setters);else if((v|m)&i)for(n in t)r.setter(e+"."+n,t[n]);return r},setters:function(e){var t=this;if(e&&w(e,v))for(var n in e)t.setter(n,e[n]);return t},serialize:function(e){for(var t,n,i=this;e&&e instanceof nt;)e=e.data();if(n=k(e),v&n?e=j({},e):m&n&&(e=e.slice()),(m|v)&n)for(t in e)n=k(e[t]),e[t]&&e[t]instanceof nt?e[t]=i.serialize(j({},e[t].data())):v&n?e[t]=i.serialize(j({},e[t])):m&n&&(e[t]=i.serialize(e[t].slice()));return e},toJSON:function(e){var t,n,i=this;n=arguments.length?i.get(e):i.data();try{t=M(i.serialize(n))}catch(r){throw r}return t},fromJSON:function(e,t){var n,i=this;if(e){try{n=S(e)}catch(r){throw r}t?i.set(t,n):i.data(n)}return i},key:function(e,t){return e&&0>t?e.split(".").slice(0,t).join("."):e},count:function(e,t){if(!arguments.length)return 0;var n=e?this.get(e):t,i=k(n);return v===i?s(n).length:m===i?n.length:y!==i?1:0},has:function(e){var t,n=this;return null==e?!1:(e=x(e))?(t=z(e.split("."),n.$data,n.$getters,nt),t?!0===t?!0:t[1].has(t[2].join(".")):!1):!1},get:function(e,t){var i,r=this;return null==e?n:(e=x(e))?(i=B(e.split("."),r.$data,t?null:r.$getters,nt),i?nt===i[0]?i[1].get(i[2].join("."),t):!1===i[0]?i[1](e):i[1]:n):n},set:function(e,t,n,i){var r,a,o,u,l,s,c,f,d=this;if(!e)return d;if(e=x(e),!e||d._atomic&&T(e,d.$atom))return d;if(r=W(e.split("."),d.$data,d.$types,d.$validators,d.$setters,nt),a=r[1],o=r[2],u=P(r[4],o),l=P(r[5],o),s=P(r[6],o),nt===r[0])o.length?(o=o.join("."),f=a.get(o),f!==t?a.set(o,t):n=!1):(f=a.data(),f!==t?a.data(t):n=!1),n&&(c={target:d,bracketkey:x(e,1),key:e,value:t,valuePrev:f},i&&(c=j({},i,c)),d.publish("change",c));else{if(!s&&!1===r[0]&&r[3].length)return d;if(u&&(t=u(t,e)),l&&!l(t,e))return n&&(c={target:d,bracketkey:x(e,1),key:e,value:t},i&&(i._error=!0,c=j({},i,c)),d.publish("error",c)),d;if(s)return s(e,t)&&(n&&(c={target:d,bracketkey:x(e,1),key:e,value:t},i&&(c=j({},i,c)),d.publish("change",c)),d.$atom&&e===d.$atom&&(d._atomic=!0)),d;f=a[o],f!==t&&(a[o]=t,n&&(c={target:d,bracketkey:x(e,1),key:e,value:t,valuePrev:f},i&&(c=j({},i,c)),d.publish("change",c)),d.$atom&&e===d.$atom&&(d._atomic=!0))}return d},append:function(e,t,n,i){var r,a,o,u,l,s,c,f,d=this;if(!e)return d;if(e=x(e),!e||d._atomic&&T(e,d.$atom))return d;if(r=W(e.split("."),d.$data,d.$types,d.$validators,d.$setters,nt),a=r[1],o=r[2],u=P(F(r[4],o),"*"),l=P(F(r[5],o),"*"),s=P(F(r[6],o),"*"),nt===r[0])o.length?(o=o.join("."),f=a.get(o),f!==t?a.set(o,t):n=!1):(f=a.data(),f!==t?a.data(t):n=!1),n&&(c={target:d,bracketkey:x(e,1),key:e,value:t,valuePrev:f},i&&(c=j({},i,c)),d.publish("change",c));else{if(!s&&(!1===r[0]&&r[3].length||!w(a[o],m)))return d;if(u&&(t=u(t,e)),l&&!l(t,e))return n&&(c={target:d,bracketkey:x(e,1),key:e,value:t},i&&(i._error=!0,c=j({},i,c)),d.publish("error",c)),d;if(s)return s(e,t)&&(n&&(c={target:d,bracketkey:x(e,1),key:e,value:t},i&&(c=j({},i,c)),d.publish("change",c)),d.$atom&&e===d.$atom&&(d._atomic=!0)),d;a[o].push(t),n&&(c={target:d,bracketkey:x(e,1),key:e,value:t},i&&(c=j({},i,c)),d.publish("append",c),d.publish("change",c)),d.$atom&&e===d.$atom&&(d._atomic=!0)}return d},del:function(e,t,n){var i,r,a,u,l,s=this;if(null==e)return s;if(e=x(e),s._atomic&&T(e,s.$atom))return s;if(i=e.split("."),!i)return s;for(a=s.$data;i.length;){if(r=i.shift(),a[r]&&a[r]instanceof nt&&i.length>0){var c=i.join(".");return u=a[r].get(c),a[r].del(c),t&&(l={target:s,bracketkey:x(e,1),key:e,value:u},n&&(l=j({},n,l)),s.publish("remove",l)),s.$atom&&e===s.$atom&&(s._atomic=!0),s}if(w(a,v|m)&&o(a,r)&&i.length>0)a=a[r];else if(i.length>0)return s}return u=a[r],delete a[r],t&&(l={target:s,bracketkey:x(e,1),key:e,value:u},n&&(l=j({},n,l)),s.publish("remove",l)),s.$atom&&e===s.$atom&&(s._atomic=!0),s},rem:function(e,t,i){var r,a,u,l,s,c,f=this;if(null==e)return f;if(e=x(e),f._atomic&&T(e,f.$atom))return f;if(r=e.split("."),!r)return f;for(u=f.$data;r.length;){if(a=r.shift(),c=k(u),u[a]&&u[a]instanceof nt&&r.length>0){var d=r.join(".");return l=u[a].get(d),u[a].rem(d),t&&(s={target:f,bracketkey:x(e,1),key:e,value:l},i&&(s=j({},i,s)),f.publish("remove",s)),f.$atom&&e===f.$atom&&(f._atomic=!0),f}if(c&(v|m)&&o(u,a)&&r.length>0)u=u[a];else if(r.length>0)return f}return n!==u[a]&&(u[a]=n,l=u[a],v==c?delete u[a]:m==c&&R(a)&&u.splice(+a,1)),t&&(s={target:f,bracketkey:x(e,1),key:e,value:l},i&&(s=j({},i,s)),f.publish("remove",s)),f.$atom&&e===f.$atom&&(f._atomic=!0),f},notify:function(e,t){return n!==e&&this.publish(t||"change",{target:this,bracketkey:x(e,1),key:x(e),value:null}),this},atom:function(e){var t=this;return n!==e&&(!1===e?(t._atomic=!1,t.$atom=null):(t._atomic=!1,t.$atom=x(e))),t},toString:function(){return this.toJSON()}});var it=function(e,t,n){var i=this;return i instanceof it?(i.id=e||G("View"),i.namespace=i.id,i.$atts=n||{bind:"data-bind"},void i.model(t||new nt).initPubSub().init()):new it(e,t,n)};it._CACHE_SIZE=600,it._REFRESH_INTERVAL=1/0,it.prototype=O(C(Object.prototype),X,{constructor:it,id:null,$dom:null,$bind:null,$model:null,$bindbubble:!1,$autobind:!1,$template:null,$atts:null,$memoize:null,$selectors:null,dispose:function(){var e=this;return e.unbind(),e.$model&&(e.$model.dispose(),e.$model=null),e.$dom=null,e.$bind=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.disposePubSub(),e},init:function(e){var t=this;return t.$bind=t.attribute("bind"),t.$memoize=new U(it._CACHE_SIZE,it._REFRESH_INTERVAL),t.$selectors=new U(it._CACHE_SIZE,it._REFRESH_INTERVAL),e&&t.publish("init",{target:t}),t},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var i=this;return arguments.length>1?(i.$atts[e]=t,i):e?i.$atts[e]||n:n},template:function(e){var t=this;return arguments.length?(w(e,g)&&(t.$template=e),t):t.$template},event:function(e,t){var i=this,r=e?"on_"+e.split(":").join("_"):null;return r&&n!==t?(i[r]=w(t,g)?t:null,i):r?i[r]:n},action:function(e,t){var i=this;return arguments.length>1?(i["do_"+e]=w(t,g)?t:null,i):e?i["do_"+e]||n:n},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},uuid:function(e){return G(e)},get:function(e,i,r){var a,o=this,u=o.$selectors;return i=i?t(i):o.$dom,r?i.find(e):(a=u.get(e),n===a&&u.set(e,a=i.find(e)),a)},attr:function(e,t){var i,r=this,a=r.$atts[t],o=r.$memoize;return a&&L(e,a)?(a=e.attr(a),i=o.get(a),n===i&&(i=S(a),i.text?(i.change={action:"set",prop:"text",key:i.text,domRef:i.domRef||null},delete i.text):i.html?(i.change={action:"set",prop:"html",key:i.html,domRef:i.domRef||null},delete i.html):i.value?(i.change={action:"set",prop:"value",key:i.value,domRef:i.domRef||null},delete i.value):i.options?(i.change={action:"set",prop:"options",key:i.options,domRef:i.domRef||null},delete i.options):i["class"]?(i.change={action:"set",prop:"class",key:i["class"],domRef:i.domRef||null},delete i["class"]):i.checked?(i.change={action:"set",prop:"checked",key:i.checked,domRef:i.domRef||null},delete i.checked):i.disabled?(i.change={action:"set",prop:"disabled",key:i.disabled,domRef:i.domRef||null},delete i.disabled):i.show?(i.change={action:"show",key:i.show,domRef:i.domRef||null},delete i.show):i.hide?(i.change={action:"hide",key:i.hide,domRef:i.domRef||null},delete i.hide):(i.css||i.attr||i.prop)&&(i.change={action:"set",key:i.key||null,domRef:i.domRef||null},i.css&&(i.change.css=i.css,delete i.css),i.attr&&(i.change.attr=i.attr,delete i.attr),i.prop&&(i.change.prop=i.prop,delete i.prop)),i.change&&"set"===i.change.action&&i.change.prop&&i.change.prop in E&&(i.change.prop=E[i.change.prop]),o.set(a,i)),i):n},eventaction:function(e,t){return e&&t&&t[e]?w(t[e],h)?{event:e,action:t[e]}:j({event:e},t[e]):null},getDomRef:function(e,n){return n&&"$this::"==n.slice(0,7)?t(n.slice(7),e):t(n)},unbind:function(e,n){var i,r,a=this,o=a.$model,u="["+a.$bind+"]",l='input[name^="'+o.id+'["],textarea[name^="'+o.id+'["],select[name^="'+o.id+'["]';return e=e||null,r=n?t(n):a.$dom,a.on_view_change&&(i=function(e){return q(e,a.namespace)},r.off(e&&e.length?e.map(i).join(" "):q("",a.namespace),[l,u].join(","))),a.offFrom(o,"",null,a.namespace),a},uiEventHandler:function(e,n){var i=this,r=i.$model,a="["+i.$bind+"]",o='input[name^="'+r.id+'["],textarea[name^="'+r.id+'["],select[name^="'+r.id+'["]',u=!1,l=!1,s=t(n),c=i.$bindbubble?i.attr(s,"bind"):null;return(e.target===n||i.$bindbubble&&c&&c.bubble)&&(l=i.$bindbubble?!!c:s.is(a),u=i.$autobind&&"change"==e.type&&s.is(o),(l||u)&&i.on_view_change(e,{el:s,_isBind:l,_isAutoBind:u})),!0},bind:function(e,n){var i,r,a,o=this,u=o.$model,l="["+o.$bind+"]",s='input[name^="'+u.id+'["],textarea[name^="'+u.id+'["],select[name^="'+u.id+'["]';e=e||["change","click"],o.$dom=t(n||window.document),o.on_view_change&&e.length&&(a=function(e){return q(e,o.namespace)},o.$dom.on(e.map(a).join(" "),[s,l].join(","),function(e){return o.uiEventHandler(e,this),!0}));for(i in o)w(o[i],g)&&/^on_model_/.test(i)&&(r=i.replace(/^on_model_/,""),r.length&&o.onTo(u,r,o[i],o.namespace));return o},sync:function(e){var n,i,r=this,a=r.$model,o="["+r.$bind+"]",u='input[name^="'+a.id+'["],textarea[name^="'+a.id+'["],select[name^="'+a.id+'["]';return e=e?t(e):r.$dom,n=r.get(o,e,!0),i=r.get(u,e,!0),r.doAction(n,Z("change"),{sync:!0}),r.$autobind&&r.doAutoBindAction(i,Z("change"),{sync:!0}),r},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},refresh:function(e,t){var n=this;return n.unbind(),n.$memoize.reset(),n.$selectors.reset(),n.bind(e,t),n},on_view_change:function(e,n){var i,r,a,o,u,l=this,s=l.$model,c=n.el,f={};n._isAutoBind&&c.attr("name")&&(i=c.attr("name"),r=x(I(s.id,i))||!1,r&&s.has(r)&&(o=c.is(":checkbox"),o?(u=l.get('input[type="checkbox"][name="'+i+'"]'),u.length>1?(a=[],u.each(function(){var e,n=t(this);e=n.is(":checked")?n.val():"",a.push(e)})):a=u.is(":checked")?u.val():""):a=c.val(),f._triggerElement=c,s.set(r,a,1,f))),!f._error&&n._isBind&&l.doAction(c,e,n),l.publish("change",n)},on_model_error:function(e,t){var n,i,r=this,a=r.$model,o=a.id+t.bracketkey,u="["+r.$bind+"]",l='input[name^="'+o+'"],textarea[name^="'+o+'"],select[name^="'+o+'"]';n=r.get(u),i=r.get(l),r.doAction(n,e,{model:t}),r.$autobind&&r.doAutoBindAction(i,e,{model:t})},on_model_change:function(e,t){var n,i,r=this,a=r.$model,o=a.id+t.bracketkey,u="["+r.$bind+"]",l='input[name^="'+o+'"],textarea[name^="'+o+'"],select[name^="'+o+'"]';n=r.get(u),i=r.get(l),t._triggerElement&&(n=n.not(t._triggerElement),i=i.not(t._triggerElement)),r.doAction(n,e,{model:t}),r.$autobind&&r.doAutoBindAction(i,e,{model:t})},do_NOP:null,do_render:function(e,t,n){if(this.$template&&n.key&&n.tpl&&(n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length)){var i,r=this,a=r.$model,o=n.key,u=n.tpl,l=n.mode||"replace";o=I(a.id,o)||!1,o&&a.has(o)&&(value=a.get(o),"replace"==l&&t.empty(),i=r.$template(u,value),i&&t.append(i))}},do_set:function(e,t,n){if(n.key||n.css||n.attr){var i,r,a,o,u,l,s=this,c=s.$model,f=n.key||!1;if(n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length){if(n.css&&(i={},w(n.css,v))){for(a in n.css)c.has(n.css[a])&&(i[a]=c.get(n.css[a]));t.css(i)}if(n.attr&&(i={},w(n.attr,v))){for(a in n.attr)c.has(n.attr[a])&&(i[a]=c.get(n.attr[a]));t.attr(i)}if(f&&(o=I(c.id,f)||!1,o&&c.has(o)&&(u=o?c.get(o):"",l=w(u,d),n.prop)))switch(r=n.prop){case E.options:if(t.is("select")&&w(u,m)){var h=t.find("optgroup"),p=t.val(),g="";h.length||(h=t),h.find("option").remove();for(var b=0;b<u.length;b++)g+=u[b]&&u[b].label?'<option value="'+u[b].value+'">'+u[b].label+"</option>":'<option value="'+u[b]+'">'+u[b]+"</option>";h.append(g),t.val(p)}break;case E.html:t.html(u);break;case E.text:t.text(u);break;case E["class"]:if(u&&u.length){var $=u.charAt(0);"-"==$?t.removeClass(u.slice(1)):"+"==$?t.addClass(u.slice(1)):t.hasClass(u)?t.hasClass(u)&&t.removeClass(u):t.addClass(u)}break;case E.value:t.val(u);break;default:E.checked==r?l?t.prop("checked",u):u==t.val()?t.prop("checked",!0):t.prop("checked",!1):E.disabled==r?l?t.prop("disabled",u):u==t.val()?t.prop("disabled",!0):t.prop("disabled",!1):t.attr(r,u)}}}},do_update:function(e,t,n){n.key&&"value"in n&&this.$model.set(I(this.$model.id,n.key),n.value,!0)},do_show:function(e,t,n){var i,r=this,a=r.$model;n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length&&(n.key?(i=I(a.id,n.key),"value"in n?n.value===a.get(i)?t.show():t.hide():a.get(i)?t.show():t.hide()):t.show())},do_hide:function(e,t,n){var i,r=this,a=r.$model;n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length&&(n.key?(i=I(a.id,n.key),"value"in n?n.value===a.get(i)?t.hide():t.show():a.get(i)?t.hide():t.show()):t.hide())},do_bind:function(e,n,i){{var r,a,o,u,l,s=this;s.$model}if(n.is("input,textarea,select")&&(l=n.attr("name")||!1)){if(r=i.key||!1,!r)return;if(a=i.value,o=w(a,d),u=n.val(),n.is(":radio"))a==u&&(s.get('input[name="'+l+'"]').not(n).prop("checked",!1),n.prop("checked",!0));else if(n.is(":checkbox")){var c=s.get('input[type="checkbox"][name="'+l+'"]');c.length>1&&w(a,m)?c.each(function(){var e=t(this);t.inArray(e.val(),a)>-1?e.prop("checked",!0):e.prop("checked",!1)}):o?n.prop("checked",a):a==u?n.prop("checked",!0):n.prop("checked",!1)}else n.val(a)}},doAction:function(e,n,i){var r=this,a=r.$model;return e.each(function(){var e,o,u,l,s,c,f=t(this),d=r.attr(f,"bind");if(d&&(e=r.eventaction(n.type,d),e&&e.action&&(o=e.event,u=e.action,!i.sync||"change"==o))){if(i.model){if(c=f.attr("name")||!1,l=c&&f.is("input,textarea,select")?I(a.id,c):e.key,!l||!T(l,i.model.bracketkey)&&!T(l,i.model.key))return;if(a._atomic&&T(l,a.$atom))return}u&&w(r["do_"+u],g)&&(s=j(!0,{},e),r["do_"+u](n,f,s),e.complete&&w(r["do_"+e.complete],g)&&setTimeout(function(){r["do_"+e.complete](n,f,s)},20))}}),this},doAutoBindAction:function(e,n,i){var r=this,a=r.$model,o={};return r.do_bind&&e.each(function(){var e,u=t(this),l=u.attr("name")||"",s=i&&i.key?i.key:I(a.id,l);if(i&&i.value)e=i.value;else{if(!s)return;if(o[s])e=o[s][0];else{if(!a.has(s))return;e=a.get(s),o[s]=[e]}}r.do_bind(n,u,{key:s,value:e})}),this},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.21",UUID:G,Extend:O,Type:et,Validation:tt,Cache:U,Model:nt,View:it}}(t,e),!function(e,t){"use strict";var n=Function.prototype.call.bind(Array.prototype.slice),i={viewClass:e.View,modelClass:e.Model,id:"view",autobind:!1,bindbubble:!1,bindAttribute:"data-bind",model:{id:"model",data:{},types:{},validators:{},getters:{},setters:{}},template:null,events:null,actions:{},handlers:{}};t.ModelView=e,t.fn.modelview=function(e){var r=n(arguments),a=r.length?r.shift():null,o=!0,u=!1,l=[];return this.each(function(){var n,s,c,f=t(this);if(f.data("modelview")){if(o=!1,s=f.data("modelview"),n=s.$model,"view"===a)l.push(s);else if("model"===a){if(r.length)return n.apply(s,r),this;l.push(n)}else if("data"===a){if(r.length)return n.data.apply(s.$model,r),this;l.push(n.data())}else"dispose"===a?(f.data("modelview",null),s.dispose()):"sync"===a?s.sync.apply(s,r):"refresh"===a&&s.refresh.apply(s,r);return this}if(!u){var d=null;e.data&&(d=e.data,delete e.data),e=t.extend(!0,{},i,e),d&&(e.data=d),u=!0}if(!e.model)return this;if(n=new e.modelClass(e.model.id,e.model.data,e.model.types,e.model.validators,e.model.getters,e.model.setters),s=new e.viewClass(e.id,n,{bind:e.bindAttribute||"data-bind"}),e.template&&s.template(e.template),e.handlers)for(var h in e.handlers)c=e.handlers[h],c&&s.event(h,c);if(e.actions)for(var p in e.actions)c=e.actions[p],c&&s.action(p,c);f.data("modelview",s),s.bindbubble(e.bindbubble).autobind(e.autobind).bind(e.events,f)}),!o&&l.length?1==this.length?l[0]:l:this}}(t.ModelView,e),t.ModelView});
